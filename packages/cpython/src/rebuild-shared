#!/usr/bin/env bash

set -ev
echo "Rebuild and run shared library of python-wasm"

export PATH=`pwd`/../../../../bin/:$PATH

touch Modules/_sqlite/*.c

rm -f build/lib.wasi-wasm32-3.11/_sqlite3.cpython-311-wasm32-emscripten.so
make CONFIGURE_LDFLAGS_NODIST="" LINKFORSHARED="-shared"
cp build/lib.wasi-wasm32-3.11/_sqlite3.cpython-311-wasm32-emscripten.so ../../dist/wasm/lib/python3.11/lib-dynload/_sqlite3.cpython-311-wasm32-wasi.so
cd ../../../python-wasm/
./bin/python-wasm-debug
