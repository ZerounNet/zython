#!/usr/bin/env bash

set -ev
echo "Rebuild and run shared modules of python-wasm"

export PATH=`pwd`/../../../../bin/:$PATH

# TODO:
touch Modules/_sqlite/*.c

rm -f Modules/*.so

make CC="zig-fPIC cc" CXX="zig-fPIC c++"  CONFIGURE_LDFLAGS_NODIST="" LINKFORSHARED="-shared" BLDSHARED="zig wasm-ld --experimental-pic -shared"

cp -v Modules/*.so ../../dist/wasm/lib/python3.11/lib-dynload/

